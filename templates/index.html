<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI PROJECT MANAGER | ELITE</title>
    <style>
        :root { --bg: #000000; --panel: #111; --border: #333; --accent: #00ff41; --text: #eee; }
        body { margin: 0; font-family: 'Courier New', monospace; background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }
        
        /* LOGIN */
        #login-screen { position: fixed; width: 100%; height: 100%; background: var(--bg); z-index: 99; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .box { border: 1px solid var(--accent); padding: 30px; background: var(--panel); width: 300px; text-align: center; box-shadow: 0 0 15px var(--accent); }
        input, textarea { width: 90%; background: #000; border: 1px solid var(--border); color: var(--accent); padding: 10px; margin: 10px 0; font-family: inherit; }
        button { width: 100%; background: var(--accent); color: #000; font-weight: bold; padding: 10px; border: none; cursor: pointer; margin-top: 5px; }
        button:hover { opacity: 0.8; }

        /* APP LAYOUT */
        #app-screen { display: none; width: 100%; height: 100%; }
        .sidebar { width: 300px; background: var(--panel); border-right: 1px solid var(--border); padding: 20px; display: flex; flex-direction: column; gap: 20px; }
        .main { flex: 1; display: flex; flex-direction: column; padding: 20px; }
        
        .section-title { color: var(--accent); border-bottom: 1px solid var(--border); padding-bottom: 5px; margin-bottom: 10px; text-transform: uppercase; }
        
        #chat-box { flex: 1; overflow-y: auto; border: 1px solid var(--border); padding: 15px; margin-bottom: 15px; background: #050505; }
        .msg { padding: 10px; margin-bottom: 10px; border-radius: 4px; white-space: pre-wrap; }
        .msg.user { background: #222; border-left: 3px solid #fff; }
        .msg.ai { background: #0a1a0a; border-left: 3px solid var(--accent); color: #cfc; }
        
        .status-ok { color: var(--accent); }
        .status-err { color: red; }
    </style>
</head>
<body>

    <div id="login-screen">
        <h1 style="color:var(--accent)">SYSTEM ACCESS</h1>
        <div class="box">
            <input type="text" id="u" placeholder="Admin ID">
            <input type="password" id="p" placeholder="Password">
            <button onclick="login()">INITIALIZE</button>
        </div>
    </div>

    <div id="app-screen">
        <div class="sidebar">
            <div>
                <div class="section-title">PROJECT SETTINGS</div>
                <label>GitHub Repo Neve (Amit l√©trehozt√°l):</label>
                <input type="text" id="repo-name" value="my-new-project">
                <label>F√°jln√©v (pl. main.py):</label>
                <input type="text" id="filename" value="main.py">
            </div>

            <div>
                <div class="section-title">RESEARCH & LEARN</div>
                <p style="font-size:0.8em; color:#888">K√ºldj be egy linket, hogy megtanulja!</p>
                <input type="text" id="learn-url" placeholder="https://...">
                <button onclick="learnUrl()">OLVASD EL √âS TANULD MEG</button>
                <div id="learn-status" style="font-size:0.8em; margin-top:5px;"></div>
            </div>
            
            <div style="margin-top:auto">
                <button onclick="logout()" style="background:#cc0000; color:white">SHUTDOWN</button>
            </div>
        </div>

        <div class="main">
            <div id="chat-box">
                <div class="msg ai">Rendszer Online. V√°rom a parancsokat, Project Manager.</div>
            </div>
            <div style="display:flex; gap:10px;">
                <textarea id="prompt" rows="3" placeholder="√çrd le a feladatot... (pl: K√©sz√≠ts egy webshopot a megtanult trendek alapj√°n)"></textarea>
                <button style="width:100px" onclick="generate()">EXECUTE</button>
            </div>
        </div>
    </div>

    <script>
        let token = localStorage.getItem('token');
        let lastCode = "";

        if(token) showApp();

        async function login() {
            let u = document.getElementById('u').value;
            let p = document.getElementById('p').value;
            let fd = new FormData(); fd.append('username',u); fd.append('password',p);
            
            let r = await fetch('/token', {method:'POST', body:fd});
            if(r.ok) {
                let d = await r.json();
                localStorage.setItem('token', d.access_token);
                token = d.access_token;
                showApp();
            } else alert('Access Denied');
        }

        function showApp() {
            document.getElementById('login-screen').style.display='none';
            document.getElementById('app-screen').style.display='flex';
        }

        async function learnUrl() {
            let url = document.getElementById('learn-url').value;
            document.getElementById('learn-status').innerText = "Tanul√°s folyamatban...";
            
            let r = await fetch('/learn', {
                method:'POST', headers:{'Content-Type':'application/json', 'Authorization':`Bearer ${token}`},
                body: JSON.stringify({url: url})
            });
            let d = await r.json();
            document.getElementById('learn-status').innerText = d.message;
            log("SYSTEM", `Megtanultam a linket: ${d.summary}`);
        }

        async function generate() {
            let txt = document.getElementById('prompt').value;
            let repo = document.getElementById('repo-name').value;
            if(!txt) return;
            
            log("YOU", txt);
            document.getElementById('prompt').value = "";
            log("AI", "Gener√°l√°s folyamatban... (Keres√©s a mem√≥ri√°ban...)");

            let r = await fetch('/generate', {
                method:'POST', headers:{'Content-Type':'application/json', 'Authorization':`Bearer ${token}`},
                body: JSON.stringify({prompt: txt, project_name: repo})
            });
            let d = await r.json();
            
            lastCode = d.response;
            
            // Itt jelen√≠tj√ºk meg a v√°laszt √©s a GITHUB gombot
            let div = document.createElement('div');
            div.className = 'msg ai';
            div.innerHTML = `<div>${d.response}</div><br><button onclick="pushToGit()">üöÄ UPLOAD TO GITHUB (${repo})</button>`;
            document.getElementById('chat-box').appendChild(div);
            document.getElementById('chat-box').scrollTop = 99999;
        }

        async function pushToGit() {
            let repo = document.getElementById('repo-name').value;
            let fname = document.getElementById('filename').value;
            
            if(!confirm(`Felt√∂lt√∂d a k√≥dot a '${repo}' repository '${fname}' f√°jlj√°ba?`)) return;

            log("SYSTEM", "Kapcsol√≥d√°s a GitHubhoz...");
            
            let r = await fetch('/deploy-github', {
                method:'POST', headers:{'Content-Type':'application/json', 'Authorization':`Bearer ${token}`},
                body: JSON.stringify({project_name: repo, file_name: fname, code_content: lastCode})
            });
            
            let d = await r.json();
            if(r.ok) log("SYSTEM", `‚úÖ SIKER! Megtekint√©s: ${d.url}`);
            else log("ERROR", `Hiba: ${d.detail}`);
        }

        function log(who, text) {
            let div = document.createElement('div');
            div.className = `msg ${who === 'YOU' ? 'user' : 'ai'}`;
            div.innerText = `[${who}] ${text}`;
            document.getElementById('chat-box').appendChild(div);
            document.getElementById('chat-box').scrollTop = 99999;
        }

        function logout() { localStorage.clear(); location.reload(); }
    </script>
</body>
</html>
