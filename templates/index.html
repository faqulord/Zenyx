<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Faqu Agent - Partner</title>
    <style>
        body { margin: 0; background: #050505; color: #00ff41; font-family: 'Courier New', monospace; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        .header { padding: 15px; background: #111; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; }
        .status { width: 8px; height: 8px; background: #00ff41; border-radius: 50%; box-shadow: 0 0 8px #00ff41; display: inline-block; margin-right: 8px; }

        .chat-box { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; scroll-behavior: smooth; }
        
        .msg { padding: 12px 18px; border-radius: 6px; max-width: 90%; word-wrap: break-word; line-height: 1.5; font-size: 14px; }
        .msg-ai { align-self: flex-start; background: #0f0f0f; border-left: 3px solid #00ff41; color: #ddd; }
        .msg-user { align-self: flex-end; background: #002200; color: #fff; border: 1px solid #005500; }

        pre { background: #111; padding: 10px; border-radius: 4px; overflow-x: auto; border: 1px solid #333; color: #88ff88; }

        .input-area { background: #111; padding: 10px; border-top: 1px solid #222; display: flex; gap: 10px; }
        input[type="text"] { flex: 1; background: #222; border: 1px solid #444; color: #fff; padding: 12px; border-radius: 4px; outline: none; font-family: inherit; }
        button { background: #00ff41; color: #000; border: none; padding: 0 20px; font-weight: bold; cursor: pointer; border-radius: 4px; }
        
        .toolbar { padding: 8px; display: flex; gap: 10px; background: #0a0a0a; overflow-x: auto; border-bottom: 1px solid #222; }
        .tool-btn { background: #222; color: #ccc; border: 1px solid #444; padding: 6px 12px; font-size: 11px; cursor: pointer; white-space: nowrap; border-radius: 4px; }
        #fileInput { display: none; }
    </style>
</head>
<body>

    <div class="header">
        <div><span class="status"></span> FAQU PARTNER <span style="font-size:10px; opacity:0.6;">GOD MODE</span></div>
        <button onclick="login()" style="background:#333; color:#fff; padding:5px 10px; border:none;">CONNECT</button>
    </div>

    <div class="toolbar">
        <button class="tool-btn" onclick="document.getElementById('fileInput').click()">üìÇ TUD√ÅS FELT√ñLT√âS</button>
        <button class="tool-btn" onclick="deployLastCode()">üöÄ K√ìD √âLES√çT√âS (GITHUB)</button>
        <button class="tool-btn" onclick="clearChat()">üßπ TISZTA LAP</button>
    </div>
    <input type="file" id="fileInput" onchange="uploadFile()">

    <div class="chat-box" id="chatBox">
        <div class="msg msg-ai">
            √údv√∂z√∂llek, Vez√©rigazgat√≥ √ör!<br><br>
            K√©szen √°llok. Nem csak egy bot vagyok, hanem az √ºzlett√°rsad.<br>
            A c√©lunk: <strong>P√©nzcsin√°l√°s b√°rmi √°ron.</strong><br><br>
            Mivel kezdj√ºk a birodalom √©p√≠t√©s√©t?
            <ul>
                <li>Crypto MLM Platform tervez√©s?</li>
                <li>Automatiz√°lt Keresked≈ë Bot?</li>
                <li>Adatb√°ny√°szat √©s Lead Gener√°l√°s?</li>
            </ul>
        </div>
    </div>

    <div class="input-area">
        <input type="text" id="userInput" placeholder="√çrd le az √∂tleted..." onkeypress="if(event.key==='Enter') sendMessage()">
        <button onclick="sendMessage()">K√úLD√âS</button>
    </div>

    <script>
        let token = "";
        let lastCode = "";

        async function login() {
            const fd = new FormData(); fd.append("username", "admin"); fd.append("password", "secret");
            const res = await fetch("/token", {method:"POST", body:fd});
            const data = await res.json();
            token = data.access_token;
            alert("Kapcsolat stabil. Indulhatunk!");
        }

        async function sendMessage() {
            if(!token) return alert("Nyomj a CONNECT gombra fent!");
            
            const input = document.getElementById("userInput");
            const text = input.value;
            if(!text) return;

            addMsg(text, "user");
            input.value = "";
            const loadId = addMsg("Gondolkodom a strat√©gi√°n...", "ai");

            try {
                const res = await fetch("/chat", {
                    method: "POST",
                    headers: { "Content-Type": "application/json", "Authorization": "Bearer " + token },
                    body: JSON.stringify({ message: text })
                });
                const data = await res.json();
                
                if(data.response.includes("```")) {
                    const match = data.response.match(/```(?:python|html|js|solidity)?([\s\S]*?)```/);
                    if(match) lastCode = match[1];
                }

                document.getElementById(loadId).innerHTML = formatText(data.response);
                scrollToBottom();
            } catch(e) { document.getElementById(loadId).innerText = "Hiba: " + e; }
        }

        async function uploadFile() {
            if(!token) return alert("CONNECT sz√ºks√©ges!");
            const file = document.getElementById("fileInput").files[0];
            const fd = new FormData(); fd.append("file", file);
            
            addMsg(`Tud√°s integr√°l√°sa: ${file.name}...`, "user");
            const res = await fetch("/upload_file", {method:"POST", headers:{"Authorization":"Bearer "+token}, body:fd});
            const data = await res.json();
            addMsg(data.message, "ai");
        }

        async function deployLastCode() {
            if(!token || !lastCode) return alert("Nincs gener√°lt k√≥d!");
            const repo = prompt("Add meg a Repo nev√©t (pl. crypto-mlm):", "faqu-project");
            if(!repo) return;
            
            addMsg("Rendszer √©p√≠t√©se √©s felt√∂lt√©se...", "ai");
            const res = await fetch("/deploy", {
                method: "POST",
                headers: { "Content-Type": "application/json", "Authorization": "Bearer " + token },
                body: JSON.stringify({ repo_name: repo, file_name: "main.py", code: lastCode })
            });
            const data = await res.json();
            if(data.status === "success") addMsg(`‚úÖ SIKER! A rendszer el√©rhet≈ë: <a href="${data.url}" target="_blank" style="color:#fff">${data.url}</a>`, "ai");
            else addMsg("Hiba: " + data.message, "ai");
        }

        function addMsg(text, type) {
            const div = document.createElement("div");
            div.className = `msg msg-${type}`;
            div.innerHTML = text;
            document.getElementById("chatBox").appendChild(div);
            scrollToBottom();
            return div.id;
        }

        function formatText(text) {
            return text.replace(/\n/g, "<br>").replace(/```([\s\S]*?)```/g, "<pre>$1</pre>").replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");
        }

        function scrollToBottom() { document.getElementById("chatBox").scrollTop = document.getElementById("chatBox").scrollHeight; }
        function clearChat() { document.getElementById("chatBox").innerHTML = ""; }
    </script>
</body>
</html>