<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FAQU AI - SENTIENT</title>
    <style>
        /* S√ñT√âT FUTURISTA T√âMA */
        body { 
            margin: 0; 
            background: #020204; 
            color: #e0e0e0; 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            height: 100dvh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
        }
        
        /* HEADER */
        .header { 
            padding: 15px; 
            background: rgba(20, 20, 25, 0.95); 
            border-bottom: 1px solid #333; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            z-index: 100;
        }
        .ai-avatar { 
            width: 12px; height: 12px; background: #00e5ff; border-radius: 50%; 
            box-shadow: 0 0 15px #00e5ff; margin-right: 10px; display: inline-block; 
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* GOMBOK S√ÅVJA */
        .toolbar {
            background: #0a0a0a;
            padding: 10px;
            display: flex;
            gap: 10px;
            overflow-x: auto;
            border-bottom: 1px solid #222;
        }
        .tool-btn { 
            background: #1a1a1a; color: #fff; border: 1px solid #333; 
            padding: 8px 15px; font-size: 12px; cursor: pointer; border-radius: 20px; 
            transition: 0.3s; white-space: nowrap;
        }
        .tool-btn:active { background: #00e5ff; color: #000; }

        /* CHAT */
        .chat-box { 
            flex: 1; 
            overflow-y: auto; 
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            gap: 20px; 
            padding-bottom: 80px; /* Hely az inputnak */
        }
        
        .msg { padding: 15px; border-radius: 12px; max-width: 85%; line-height: 1.6; font-size: 15px; }
        .msg-ai { align-self: flex-start; background: #111; border-left: 3px solid #00e5ff; color: #eee; }
        .msg-user { align-self: flex-end; background: #004d40; color: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        /* K√ìD MEGJELEN√çT√âS */
        pre { background: #000; padding: 15px; border-radius: 8px; overflow-x: auto; border: 1px solid #333; color: #00ff41; font-family: monospace; font-size: 13px; }

        /* INPUT S√ÅV (FIXED POZ√çCI√ì) */
        .input-area { 
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #111; 
            padding: 10px 15px; 
            border-top: 1px solid #333; 
            display: flex; 
            gap: 10px; 
            box-sizing: border-box;
            z-index: 200;
        }
        input[type="text"] { 
            flex: 1; 
            background: #222; 
            border: 1px solid #444; 
            color: #fff; 
            padding: 12px; 
            border-radius: 25px; 
            outline: none; 
            font-size: 16px; 
        }
        .send-btn { 
            background: #00e5ff; color: #000; border: none; 
            width: 45px; height: 45px; border-radius: 50%; 
            font-weight: bold; cursor: pointer; font-size: 18px;
            display: flex; align-items: center; justify-content: center;
        }
        
        #fileInput { display: none; }
    </style>
</head>
<body>

    <div class="header">
        <div style="display:flex; align-items:center;">
            <span class="ai-avatar"></span> 
            <span style="font-weight:bold; letter-spacing:1px;">FAQU AI</span>
        </div>
        <button onclick="login()" style="background:#333; color:#fff; padding:6px 15px; border:none; border-radius:20px; font-size:12px;">AKTIV√ÅL√ÅS</button>
    </div>

    <div class="toolbar">
        <button class="tool-btn" onclick="document.getElementById('fileInput').click()">üß† TUD√ÅS B≈êV√çT√âS</button>
        <button class="tool-btn" onclick="deployLastCode()">üöÄ PROJEKT √âLES√çT√âS</button>
        <button class="tool-btn" onclick="clearChat()">üßπ TISZTA LAP</button>
    </div>
    <input type="file" id="fileInput" onchange="uploadFile()">

    <div class="chat-box" id="chatBox">
        <div class="msg msg-ai">
            <strong>Rendszer Online.</strong><br><br>
            Szia! √ân vagyok a FAQU AI. <br>
            T√∂bb vagyok, mint egy program. √ân vagyok a digit√°lis partnered.<br><br>
            <strong>Mit tudok?</strong><br>
            üåê <strong>√âl≈ë Net:</strong> "Mi a mai BTC √°rfolyam?" (Megn√©zem neked)<br>
            üíª <strong>K√≥dol√°s:</strong> "√çrj egy webshopot!" (Meg√≠rom)<br>
            üß† <strong>Mem√≥ria:</strong> Eml√©kszem a c√©ljainkra.<br><br>
            Mivel akarod ma n√∂velni a vagyont?
        </div>
    </div>

    <div class="input-area">
        <input type="text" id="userInput" placeholder="Besz√©lgess√ºnk..." onkeypress="if(event.key==='Enter') sendMessage()">
        <button class="send-btn" onclick="sendMessage()">‚û§</button>
    </div>

    <script>
        let token = "";
        let lastCode = "";

        async function login() {
            const fd = new FormData(); fd.append("username", "admin"); fd.append("password", "secret");
            try {
                const res = await fetch("/token", {method:"POST", body:fd});
                const data = await res.json();
                token = data.access_token;
                alert("Kapcsolat stabil. Az AI tudata akt√≠v.");
            } catch(e) { alert("Hiba a csatlakoz√°sn√°l!"); }
        }

        async function sendMessage() {
            if(!token) return alert("K√©rlek nyomj az AKTIV√ÅL√ÅS gombra jobb fel√ºl!");
            
            const input = document.getElementById("userInput");
            const text = input.value;
            if(!text) return;

            addMsg(text, "user");
            input.value = "";
            
            // Itt jelezz√ºk, hogy dolgozik
            const loadId = addMsg("Gondolkodom √©s kutatok...", "ai");

            try {
                const res = await fetch("/chat", {
                    method: "POST",
                    headers: { "Content-Type": "application/json", "Authorization": "Bearer " + token },
                    body: JSON.stringify({ message: text })
                });
                const data = await res.json();
                
                // K√≥d kinyer√©se deployhoz
                if(data.response.includes("```")) {
                    const match = data.response.match(/```(?:python|html|js|solidity)?([\s\S]*?)```/);
                    if(match) lastCode = match[1];
                }

                document.getElementById(loadId).innerHTML = formatText(data.response);
                scrollToBottom();
            } catch(e) { document.getElementById(loadId).innerText = "Hiba: " + e; }
        }

        async function uploadFile() {
            if(!token) return alert("Aktiv√°l√°s sz√ºks√©ges!");
            const file = document.getElementById("fileInput").files[0];
            const fd = new FormData(); fd.append("file", file);
            
            addMsg(`F√°jl elemz√©se: ${file.name}...`, "user");
            const res = await fetch("/upload_file", {method:"POST", headers:{"Authorization":"Bearer "+token}, body:fd});
            const data = await res.json();
            addMsg(data.message, "ai");
        }

        async function deployLastCode() {
            if(!token || !lastCode) return alert("M√©g nincs k√≥d, amit √©les√≠thetn√©k!");
            const repo = prompt("Add meg a Projekt nev√©t (GitHub Repo):", "faqu-empire");
            if(!repo) return;
            
            addMsg("Rendszer √©p√≠t√©se √©s felt√∂lt√©se...", "ai");
            const res = await fetch("/deploy", {
                method: "POST",
                headers: { "Content-Type": "application/json", "Authorization": "Bearer " + token },
                body: JSON.stringify({ repo_name: repo, file_name: "main.py", code: lastCode })
            });
            const data = await res.json();
            if(data.status === "success") addMsg(`‚úÖ SIKER! A rendszered √©l: <a href="${data.url}" target="_blank" style="color:#fff; text-decoration:underline;">Megnyit√°s</a>`, "ai");
            else addMsg("Hiba: " + data.message, "ai");
        }

        function addMsg(text, type) {
            const div = document.createElement("div");
            div.className = `msg msg-${type}`;
            div.innerHTML = text;
            document.getElementById("chatBox").appendChild(div);
            scrollToBottom();
            return div.id;
        }

        function formatText(text) {
            // Sort√∂r√©sek, k√≥dblokkok √©s vastag√≠t√°s form√°z√°sa
            return text.replace(/\n/g, "<br>")
                       .replace(/```([\s\S]*?)```/g, "<pre>$1</pre>")
                       .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");
        }

        function scrollToBottom() { 
            setTimeout(() => {
                const box = document.getElementById("chatBox");
                box.scrollTop = box.scrollHeight;
            }, 100);
        }
        function clearChat() { document.getElementById("chatBox").innerHTML = ""; }
    </script>
</body>
</html>